#! /bin/bash


function fn_usage()
{
    echo "
        ----------- Usage --------------
        a   find ! -name '.' -a -name '*' | xargs -I{} svn add --force {}  | cat -n
        c   ci [files...]
        cf  conflict
        D   {?|M}
        d   diff  dh:[horizontal-split-diff]
        dc  svn diff -rBASE:\${filelist}
        dl  equal [Svn S clang]
        dp  diff -r 'PREV' check.change:[svn diff -c REV]
        f   ln -sf ~/.flowchar/main.i .flowchar.i
        h   svn help cmd
        ps  svn ps svn:execute on __files_to_add_x__
        q   -q status
        r   revert -R {file|dir}
        s   status
        S   status | grep PAT
        u   update

        svn help _____more.info_____
    "
}

function fn_main()
{
    filelist="${@:2}"

    case $1 in
    a)
        /usr/bin/find ! -name '.' -a -name '*' | xargs -I{} svn add --force {}  | cat -n
        ;;
    c|ci)
        svn ci $filelist
        ;;
    cf|conflict)
        echo "
        1 svn update {df|edit|resolved}
        2 svn resolve --accept base
        3 vim ; svn resolved
        4 svn revert
        "
        ;;
    D)
        {
        echo "Deleting: "
        exclude="INSTALL|cscope|.make"
        svn status | grep -v -E "${exclude}" | grep "^${filelist:-?}" | tee /dev/stderr |\
            awk '{print $2}' | xargs -I{} rm -rf {}
        } 2>&1 | sed 's/^/\t/g'
        ;;
    d)  svn diff $filelist ;;
    dc) svn diff -rBASE:${filelist} ;;
    dl) svn diff `Svn S clang | awk '{print $2}'` ;;
    dh) HORI=-o \
        svn diff $filelist ;;
    f)  ln -sf ~/.flowchar/main.i .flowchar.i   ;;
    dp) svn diff -r 'PREV' $filelist            ;;
    r)
        [ -z "$filelist" ] && echo "Error: file... must be dedicated" && exit
        svn --depth=infinity revert $filelist
        ;;
    s)  svn status $filelist                                            ;;
    S)  for i in ${filelist//clang/'\.c$ \.h$ \.cpp$'}; do
            svn status | grep -i --color "$i"
        done                                                            ;;
    ps) svn ps svn:executable on $filelist; ls -l --color $filelist     ;;
    q)  svn -q status                                                   ;;
    u)  svn up $filelist                                                ;;
  h|*)  fn_usage
        svn status | sed 's/^/\t/g'
        ;;
    esac

}

fn_main $@
