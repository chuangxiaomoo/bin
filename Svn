#! /bin/bash


function fn_usage()
{
    echo "
        ----------- Usage --------------
        a   find ! -name '.' -a -name '*' | xargs -I{} svn add --force {}  | cat -n
        c   ci [files...]
        cf  conflict
        D   {?|M}
        d   diff. [dh:horizontal-split-diff]
        dp  diff -r 'PREV'
        h   svn help cmd
        q   -q status
        r   revert -R {file|dir}
        s   status
        S   status | grep PAT
        u   update

        svn help _____more.info_____
    "
}

function fn_main()
{
    filelist="${@:2}"

    case $1 in
    a)
        /usr/bin/find ! -name '.' -a -name '*' | xargs -I{} svn add --force {}  | cat -n
        ;;
    c|ci)
        svn ci $filelist
        ;;
    cf|conflict)
        echo "
        1 svn update {df|edit|resolved}
        2 svn resolve --accept base
        3 vim ; svn resolved
        4 svn revert
        "
        ;;
    D)
        {
        echo "Deleting: "
        exclude="INSTALL|cscope|.make"
        svn status | grep -v -E "${exclude}" | grep "^${filelist:-?}" | tee /dev/stderr |\
            awk '{print $2}' | xargs -I{} rm -rf {}
        } 2>&1 | sed 's/^/\t/g'
        ;;
    d)  svn diff $filelist ;;
    dh) HORI=-o \
        svn diff $filelist ;;
    dp) svn diff -r 'PREV' $filelist ;;
    dc) svn diff -c        $filelist ;;
    dr) svn diff -r        $filelist ;;
    r)
        [ -z "$filelist" ] && echo "Error: file... must be dedicated" && exit
        svn --depth=infinity revert $filelist
        ;;
    s)  svn status $filelist                                ;;
    S)  for i in ${filelist//clang/\.c$ \.h$ \.cpp$}; do
            svn status | grep -i --color "$i"
        done                                                ;;
    q)  svn -q status                                       ;;
    u|up)
        svn up $filelist
        ;;
    h)
        svn help $filelist
        ;;
    *)
        fn_usage
        svn status | sed 's/^/\t/g'
        ;;
    esac

}

fn_main $@
