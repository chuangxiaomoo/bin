# tables

DROP TABLE IF EXISTS d1;
CREATE TABLE d1 (
    date        date NOT NULL, 
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    setl        DECIMAL(6,2)  NOT NULL,
    open        DECIMAL(6,2)  NOT NULL,
    high        DECIMAL(6,2)  NOT NULL,
    low         DECIMAL(6,2)  NOT NULL,
    close       DECIMAL(6,2)  NOT NULL,

    volume      DECIMAL(12,2) NOT NULL DEFAULT 0,
    tov         DECIMAL(12,2) NOT NULL DEFAULT 0,

    ma5         DECIMAL(6,2)  NOT NULL DEFAULT 0,
    ma20        DECIMAL(6,2)  NOT NULL DEFAULT 0,
    ma60        DECIMAL(6,2)  NOT NULL DEFAULT 0,

    hsl20       DECIMAL(12,2) NOT NULL DEFAULT 0, 
    vr1_2       DECIMAL(12,2) NOT NULL DEFAULT 0, 
    vr3_10      DECIMAL(12,2) NOT NULL DEFAULT 0,  
    vr5_20      DECIMAL(12,2) NOT NULL DEFAULT 0, 
    vrd_30      DECIMAL(12,2) NOT NULL DEFAULT 0,
    vrt_60      DECIMAL(12,2) NOT NULL DEFAULT 0,

    INDEX(code,date)
);

          
CREATE TABLE nmcap (
    date        date NOT NULL, 
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    name        CHAR(16),
    setl        DECIMAL(6,2) NOT NULL,
    open        DECIMAL(6,2) NOT NULL,
    high        DECIMAL(6,2) NOT NULL,
    low         DECIMAL(6,2) NOT NULL,
    close       DECIMAL(6,2) NOT NULL,
    p_change    DECIMAL(6,2) NOT NULL,
    volume      DECIMAL(12,2) NOT NULL,
    turnover    DECIMAL(12,2) NOT NULL,

    amount      DECIMAL(12,2) NOT NULL,
    pe          DECIMAL(12,2) NOT NULL,
    pb          DECIMAL(12,2) NOT NULL,
    cap         DECIMAL(12,2) NOT NULL,
    nmc         DECIMAL(12,2) NOT NULL,

    INDEX(code,date)
);


DROP TABLE IF EXISTS udate;
CREATE TABLE udate (
    udate       date NOT NULL, 
    utime       time NOT NULL, 
    mdate       date NOT NULL, 
    mtime       time NOT NULL
);

DROP TABLE IF EXISTS top10;
CREATE TABLE IF NOT EXISTS top10(
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    top10       DECIMAL(6,2) NOT NULL,
    INDEX(code)
);
LOAD DATA LOCAL INFILE '/root/cdo/top10' INTO TABLE top10;


DROP TABLE IF EXISTS uni;
CREATE TABLE IF NOT EXISTS uni(
    date        date NOT NULL, 
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    close       DECIMAL(6,2)  NOT NULL,
    ma5         DECIMAL(6,2)  NOT NULL DEFAULT 0,
    ma10        DECIMAL(6,2)  NOT NULL DEFAULT 0,
    ma20        DECIMAL(6,2)  NOT NULL DEFAULT 0,
    top10       DECIMAL(6,2)  NOT NULL,
    p_change    DECIMAL(6,2)  NOT NULL,
    tov         DECIMAL(12,2) NOT NULL DEFAULT 0,
    hsl20       DECIMAL(12,2) NOT NULL DEFAULT 0, 
    vr1_2       DECIMAL(12,2) NOT NULL DEFAULT 0, 
    vr3_10      DECIMAL(12,2) NOT NULL DEFAULT 0,  
    vr5_20      DECIMAL(12,2) NOT NULL DEFAULT 0, 
    vrd_30      DECIMAL(12,2) NOT NULL DEFAULT 0,
    vrt_60      DECIMAL(12,2) NOT NULL DEFAULT 0,
    amount      DECIMAL(12,2) NOT NULL,
    nmc         DECIMAL(12,2) NOT NULL,
    INDEX(code)
);

DROP TABLE IF EXISTS 60zm;
CREATE TABLE IF NOT EXISTS 60zm(
    date   date            NOT NULL DEFAULT 0,
    code   INT(6) ZEROFILL NOT NULL DEFAULT 0,

    hi3    DECIMAL(6, 2)   NOT NULL DEFAULT 0,
    lo3    DECIMAL(6, 2)   NOT NULL DEFAULT 0,
    n3     TINYINT         NOT NULL DEFAULT 0,
    hi2    DECIMAL(6, 2)   NOT NULL DEFAULT 0,  # 中枢上线
    lo2    DECIMAL(6, 2)   NOT NULL DEFAULT 0,  # 中枢下线
    n2     TINYINT         NOT NULL DEFAULT 0,  # count(顶)
    hi     DECIMAL(6, 2)   NOT NULL DEFAULT 0,
    lo     DECIMAL(6, 2)   NOT NULL DEFAULT 0,
    n      TINYINT         NOT NULL DEFAULT 0,

    top0   DECIMAL(6, 2)   NOT NULL DEFAULT 0,  # bi0是上升笔时剔除，最新高点
    top1   DECIMAL(6, 2)   NOT NULL DEFAULT 0,  #                    次新高点
    top2   DECIMAL(6, 2)   NOT NULL DEFAULT 0,  #
    cvg3   DECIMAL(6, 2)   NOT NULL DEFAULT 0,
    bot0   DECIMAL(6, 2)   NOT NULL DEFAULT 0,  # bi0是上升笔时剔除，最新低点
    bot1   DECIMAL(6, 2)   NOT NULL DEFAULT 0,  #                    次新低点
    botx   DECIMAL(6, 2)   NOT NULL DEFAULT 0,  # botx=bot2, 默认3底以上最3底，后续可优化

    close  DECIMAL(6, 2)   NOT NULL DEFAULT 0,
    ma20   DECIMAL(6, 2)   NOT NULL DEFAULT 0,
    o      TINYINT         NOT NULL DEFAULT 0,  # osci, 当前笔的振荡数
                                                # 未成笔K线数，(bi0 is ASC) ? +N : -N
    z      TINYINT         NOT NULL DEFAULT 0,  # zor5, 最近5K中＞中枢上线的K线数
                                                # 转折点价位
                                                # (bi0 is DEC) ? bot0
                                                #              : (o==1)?close:top(bi0)后的low
    INDEX(date, code)
);

    alter table dzm change z z DECIMAL(6,2) NOT NULL DEFAULT 0;

DROP TABLE IF EXISTS 30zm; CREATE TABLE IF NOT EXISTS 30zm LIKE 60zm;
DROP TABLE IF EXISTS dzm ; CREATE TABLE IF NOT EXISTS  dzm LIKE 60zm;

DROP TABLE IF EXISTS maxp;
CREATE TABLE maxp (
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    date        date NOT NULL, 
    high        DECIMAL(6,2) NOT NULL,
    volume      DECIMAL(12,2) NOT NULL DEFAULT 0,
    INDEX(code,date)
);

DROP TABLE IF EXISTS mvp;
CREATE TABLE mvp (
    date        date NOT NULL, 
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,     # | cnt  | note       |
    high        DECIMAL(6,2) NOT NULL,                  # | :--- | :------    |
    xvol        DECIMAL(12,2) NOT NULL DEFAULT 0,       # | -1   | 量新高     |
    cnt         TINYINT NOT NULL DEFAULT 0,             # |  0   | 量价齐新高 |
    INDEX(code,date)                                    # |  n   | 价新高     |
);

DROP TABLE IF EXISTS HH34;
CREATE TABLE HH34 (
    date        date NOT NULL, 
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    high        DECIMAL(6,2) NOT NULL,                  # HH(34)
    cnt         TINYINT NOT NULL DEFAULT 0,             # mvp.cnt
    lightgo     TINYINT NOT NULL DEFAULT 0,             # count(mvp.cnt>0)
    INDEX(code,date)
);

DROP TABLE IF EXISTS balance;
CREATE TABLE balance (
    date        date NOT NULL, 
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    name        CHAR(16),
    sell        TINYINT NOT NULL DEFAULT 0,
    price       DECIMAL(6,2) NOT NULL,
    vol         DECIMAL(6,2) NOT NULL,
    INDEX(code,date)
);

LOAD DATA LOCAL INFILE '/tmp/balance.txt' INTO TABLE balance;
SELECT * FROM (SELECT code,name, sum(sell*price*vol) as bala FROM balance GROUP by code) as t  ORDER by bala DESC ;

DROP TABLE IF EXISTS stamp;
CREATE TABLE stamp (
    name        CHAR(16) PRIMARY KEY,   # PRIMARY KEY is compulsive
    date        date NOT NULL, 
    INDEX(name)
);       
INSERT INTO stamp (name,date) VALUES ('god', '2014-08-08') ON DUPLICATE KEY UPDATE date=VALUES(date);

DROP TABLE IF EXISTS q5;
CREATE TABLE q5 (
    date        date NOT NULL, 
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    p_change    DECIMAL(6,2)  NOT NULL DEFAULT 0,
    v5          DECIMAL(12,2) NOT NULL DEFAULT 0,
    v4          DECIMAL(12,2) NOT NULL DEFAULT 0,
    v3          DECIMAL(12,2) NOT NULL DEFAULT 0,
    v2          DECIMAL(12,2) NOT NULL DEFAULT 0,
    v1          DECIMAL(12,2) NOT NULL DEFAULT 0,
    q5          TINYINT       NOT NULL DEFAULT 0,
    rock        TINYINT       NOT NULL DEFAULT 0,    # p1>p2 or p1>p3 Diamond-Bottom-Price(rock bottom prices)
    INDEX(date,code)
);

DROP TABLE IF EXISTS vbot5;
CREATE TABLE vbot5 (
    date        date NOT NULL, 
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    L0          DECIMAL(6,2) NOT NULL DEFAULT 0,
    H0          DECIMAL(6,2) NOT NULL DEFAULT 0,
    L1          DECIMAL(6,2) NOT NULL DEFAULT 0,
    H1          DECIMAL(6,2) NOT NULL DEFAULT 0,
    L2          DECIMAL(6,2) NOT NULL DEFAULT 0,
    H2          DECIMAL(6,2) NOT NULL DEFAULT 0,
    L3          DECIMAL(6,2) NOT NULL DEFAULT 0,
    H3          DECIMAL(6,2) NOT NULL DEFAULT 0,
    flag        TINYINT      NOT NULL DEFAULT 0,
    INDEX(date,code)
);

DROP TABLE IF EXISTS ma180;
CREATE TABLE ma180 (
    date        date NOT NULL, 
    code        INT(6) ZEROFILL NOT NULL DEFAULT 0,
    ma180       DECIMAL(6,2) NOT NULL DEFAULT 0,
    INDEX(date,code)
);
